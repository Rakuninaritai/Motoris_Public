{% extends 'base.html' %}
{% load static %}
{% block title %}
    {{ user.username }}の編集ページ
{% endblock %}
{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/profile.css' %}" />
{% endblock %}

{% block content %}
  <div class="container mb-5">
    <div class="row">
      <div class="col-1"></div>

      <div class="col-10">
        <div class="row mt-5">
          <div class="col-12 col-md-2">
            <form method="post" enctype="multipart/form-data">
              {% csrf_token %}
              <div class="profile-image border rounded-circle overflow-hidden" style="width: 150px; height: 150px;">
                <label for="id_profile_image" style="cursor: pointer;">
                  <img id="preview-image" src="{{ profile.get_image_url }}" alt="プロフィール画像" class="rounded-circle" style="width: 150px; height: 150px; object-fit: cover;">
                </label>
                <input type="file" id="id_profile_image" name="profile_image" accept="image/*" style="display: none;" onchange="previewImage(this);">
              </div>
              <small class="text-muted d-block text-center mt-2">画像をクリックして変更</small>
          </div>
          <!--<div class="col-1"></div> -->
          <div class="col">
            <h2>{{ user.username }}</h2>
            <div class="form-group mt-3">
              <label for="id_username">ユーザー名</label>
              <input type="text" class="form-control" id="id_username" name="username" value="{{ user.username }}">
            </div>
          </div>
        </div>

        <div class="mt-4 mb-5">
          <div class="form-group">
            <label for="id_bio">自己紹介</label>
            <textarea class="form-control" id="id_bio" name="bio" rows="4">{{ user.profile.bio|default:"自己紹介は設定されていません..." }}</textarea>
          </div>
        </div>

        <div class="d-flex justify-content-between mt-4">
          <div>
            <button type="submit" class="btn btn-primary">保存</button>
            <a href="{% url 'profile' %}" class="btn btn-outline-secondary ms-2">キャンセル</a>
          </div>
          </form>
          <form method="post" action="{% url 'logout' %}" class="d-inline">
            {% csrf_token %}
            <button type="submit" class="btn btn-outline-danger">ログアウト</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script>
    function previewImage(input) {
      if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function(e) {
          document.getElementById('preview-image').src = e.target.result;
        };
        reader.readAsDataURL(input.files[0]);
      }
    }
  </script>
{% endblock %}